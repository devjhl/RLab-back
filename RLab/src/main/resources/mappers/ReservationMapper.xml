<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.kh.RLab.dao.ReservationDAO">
	<select id="selectAllPointById" resultType="int">
		select ifnull(sum(po_amount),0) from point where po_me_id = #{me_id} and po_state = 1
	</select>
	<insert id="insertPay" useGeneratedKeys="true" keyProperty="pa.pa_num">
		insert into pay(pa_order_id,pa_me_id, pa_order_name, pa_date, pa_amount, pa_point, pa_used_point)
		values(#{pa.pa_order_id},#{pa.pa_me_id},#{pa.pa_order_name},now(),#{pa.pa_amount},#{pa.pa_point},#{pa.pa_used_point})
	</insert>
	<insert id="insertPayDetail">
		insert into pay_detail(pd_pa_order_id, pd_ti_num, pd_amount, pd_price, pd_state)
		values
		<foreach collection="items" item="i" separator=",">
			(#{pa_order_id}, #{i.pd_ti_num}, #{i.pd_amount}, #{i.pd_price}, '결제중')
		</foreach>
	</insert>
	<select id="selectPayByPaOrderId" resultType="kr.kh.RLab.vo.PayDTO">
		select * from pay where pa_order_id = #{pa_order_id}
	</select>
</mapper>
