<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.kh.RLab.dao.BoardDAO">

	<insert id="insertBoard">
    insert into board(bo_st_num, bo_title, bo_content, bo_me_id, bo_reg_date)
    	values(#{board.bo_st_num}, #{board.bo_title}, #{board.bo_content}, #{board.bo_me_id}, NOW())
	</insert>
	
	<select id="selectBoardList" parameterType="map" resultType="kr.kh.RLab.vo.BoardVO">
	    SELECT b.*, COUNT(s.sc_bo_num) as scrap_count
	    FROM board b
	    LEFT JOIN study ON b.bo_st_num = st_num
	    LEFT JOIN member ON b.bo_me_id = me_id
	    LEFT JOIN scrap s ON b.bo_num = s.sc_bo_num AND s.sc_state = 1
	    GROUP BY b.bo_num
	    <if test="orderBy != null">
	        ORDER BY ${orderBy}
	    </if>
	    LIMIT #{offset}, #{pageSize}
	</select>
	
	<select id="getBoard" resultType="kr.kh.RLab.vo.BoardVO">
		select
			*
		from
			board
		join member 
		on  bo_me_id = me_id
		where
			bo_num = #{bo_num}
		
	</select>
	
	<select id="getCount" resultType="int">
		select
			count(*)
		from
			board
	</select>
	
	<update id="countViews">
  		update board 
  			set 
  				bo_views = bo_views+1 
  			where 
  				bo_num = #{bo_num}
  	</update>
  	
</mapper>